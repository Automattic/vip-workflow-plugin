(()=>{"use strict";var e={4764:(e,t,s)=>{s.d(t,{M_:()=>r.M});var r=s(9406)},7805:(e,t,s)=>{s.r(t),s.d(t,{closeModal:()=>S,disableComplementaryArea:()=>l,enableComplementaryArea:()=>c,openModal:()=>_,pinItem:()=>u,setDefaultComplementaryArea:()=>i,setFeatureDefaults:()=>f,setFeatureValue:()=>m,toggleFeature:()=>p,unpinItem:()=>d});var r=s(4040),o=s.n(r),n=s(1233),a=s(9561);const i=(e,t)=>({type:"SET_DEFAULT_COMPLEMENTARY_AREA",scope:e=(0,a.F)(e),area:t=(0,a.M)(e,t)}),c=(e,t)=>({registry:s,dispatch:r})=>{t&&(e=(0,a.F)(e),t=(0,a.M)(e,t),s.select(n.store).get(e,"isComplementaryAreaVisible")||s.dispatch(n.store).set(e,"isComplementaryAreaVisible",!0),r({type:"ENABLE_COMPLEMENTARY_AREA",scope:e,area:t}))},l=e=>({registry:t})=>{e=(0,a.F)(e),t.select(n.store).get(e,"isComplementaryAreaVisible")&&t.dispatch(n.store).set(e,"isComplementaryAreaVisible",!1)},u=(e,t)=>({registry:s})=>{if(!t)return;e=(0,a.F)(e),t=(0,a.M)(e,t);const r=s.select(n.store).get(e,"pinnedItems");!0!==r?.[t]&&s.dispatch(n.store).set(e,"pinnedItems",{...r,[t]:!0})},d=(e,t)=>({registry:s})=>{if(!t)return;e=(0,a.F)(e),t=(0,a.M)(e,t);const r=s.select(n.store).get(e,"pinnedItems");s.dispatch(n.store).set(e,"pinnedItems",{...r,[t]:!1})};function p(e,t){return function({registry:s}){o()("dispatch( 'core/interface' ).toggleFeature",{since:"6.0",alternative:"dispatch( 'core/preferences' ).toggle"}),s.dispatch(n.store).toggle(e,t)}}function m(e,t,s){return function({registry:r}){o()("dispatch( 'core/interface' ).setFeatureValue",{since:"6.0",alternative:"dispatch( 'core/preferences' ).set"}),r.dispatch(n.store).set(e,t,!!s)}}function f(e,t){return function({registry:s}){o()("dispatch( 'core/interface' ).setFeatureDefaults",{since:"6.0",alternative:"dispatch( 'core/preferences' ).setDefaults"}),s.dispatch(n.store).setDefaults(e,t)}}function _(e){return{type:"OPEN_MODAL",name:e}}function S(){return{type:"CLOSE_MODAL"}}},8991:(e,t,s)=>{s.d(t,{E:()=>r});const r="core/interface"},9561:(e,t,s)=>{s.d(t,{F:()=>n,M:()=>a});var r=s(4040),o=s.n(r);function n(e){return["core/edit-post","core/edit-site"].includes(e)?(o()(`${e} interface scope`,{alternative:"core interface scope",hint:"core/edit-post and core/edit-site are merging.",version:"6.6"}),"core"):e}function a(e,t){return"core"===e&&"edit-site/template"===t?(o()("edit-site/template sidebar",{alternative:"edit-post/document",version:"6.6"}),"edit-post/document"):"core"===e&&"edit-site/block-inspector"===t?(o()("edit-site/block-inspector sidebar",{alternative:"edit-post/block",version:"6.6"}),"edit-post/block"):t}},9406:(e,t,s)=>{s.d(t,{M:()=>c});var r=s(7143),o=s(7805),n=s(532),a=s(4962),i=s(8991);const c=(0,r.createReduxStore)(i.E,{reducer:a.Ay,actions:o,selectors:n});(0,r.register)(c)},4962:(e,t,s)=>{s.d(t,{Ay:()=>r});const r=(0,s(7143).combineReducers)({complementaryAreas:function(e={},t){switch(t.type){case"SET_DEFAULT_COMPLEMENTARY_AREA":{const{scope:s,area:r}=t;return e[s]?e:{...e,[s]:r}}case"ENABLE_COMPLEMENTARY_AREA":{const{scope:s,area:r}=t;return{...e,[s]:r}}}return e},activeModal:function(e=null,t){switch(t.type){case"OPEN_MODAL":return t.name;case"CLOSE_MODAL":return null}return e}})},532:(e,t,s)=>{s.r(t),s.d(t,{getActiveComplementaryArea:()=>c,isComplementaryAreaLoading:()=>l,isFeatureActive:()=>d,isItemPinned:()=>u,isModalActive:()=>p});var r=s(7143),o=s(4040),n=s.n(o),a=s(1233),i=s(9561);const c=(0,r.createRegistrySelector)((e=>(t,s)=>{s=(0,i.F)(s);const r=e(a.store).get(s,"isComplementaryAreaVisible");if(void 0!==r)return!1===r?null:t?.complementaryAreas?.[s]})),l=(0,r.createRegistrySelector)((e=>(t,s)=>{s=(0,i.F)(s);const r=e(a.store).get(s,"isComplementaryAreaVisible"),o=t?.complementaryAreas?.[s];return r&&void 0===o})),u=(0,r.createRegistrySelector)((e=>(t,s,r)=>{var o;s=(0,i.F)(s),r=(0,i.M)(s,r);const n=e(a.store).get(s,"pinnedItems");return null===(o=n?.[r])||void 0===o||o})),d=(0,r.createRegistrySelector)((e=>(t,s,r)=>(n()("select( 'core/interface' ).isFeatureActive( scope, featureName )",{since:"6.0",alternative:"select( 'core/preferences' ).get( scope, featureName )"}),!!e(a.store).get(s,r))));function p(e,t){return e.activeModal===t}},3393:(e,t,s)=>{s.d(t,{A:()=>p});var r=s(1609),o=s(6427),n=s(7143),a=s(4309),i=s(3656),c=s(6087),l=s(7723),u=s(7527);const d=VW_CUSTOM_STATUSES.status_terms.map((e=>({label:e.name,value:e.slug})));function p({onUpdateStatus:e,postType:t,status:s}){const[p,m]=(0,c.useState)(!1);if(!(0,u.C)(t,s))return null;const f=VW_CUSTOM_STATUSES.status_terms.find((e=>e.slug===s))?.name;return(0,r.createElement)(a.PluginPostStatusInfo,{className:`vip-workflow-extended-post-status vip-workflow-extended-post-status-${s}`},(0,r.createElement)("div",{className:"vip-workflow-extended-post-status-section"},(0,r.createElement)("h4",null,(0,l.__)("Extended Post Status","vip-workflow")),!p&&(0,r.createElement)("div",{className:"vip-workflow-extended-post-status-edit"},f,(0,r.createElement)(o.Button,{size:"compact",variant:"link",onClick:()=>m(!0)},(0,l.__)("Edit","vip-workflow"))),p&&(0,r.createElement)(o.SelectControl,{label:"",value:s,options:d,onChange:t=>{e(t),(0,n.dispatch)(i.store).savePost(),m(!1)}})),(0,r.createElement)("div",{className:"vip-workflow-edit-help-text"},(0,r.createElement)(o.BaseControl,{help:(0,l.__)('Click "Edit" to skip a custom status, or rollback to a previous state.',"vip-workflow")})))}(0,n.subscribe)((function(){if((0,n.select)(i.store).getCurrentPostId()&&((0,n.select)(i.store).isCleanNewPost()&&(0,n.dispatch)(i.store).editPost({status:d[0].value}),VW_CUSTOM_STATUSES.is_publish_guard_enabled)){const e=document.querySelectorAll("#vip-workflow-editorial-metadata-label");if(!e||0===e.length)return;const t=VW_CUSTOM_STATUSES.status_terms.find((e=>e.slug===(0,n.select)(i.store).getCurrentPostAttribute("status")));if(!t)return;e.forEach((e=>{e?.classList&&(t?.meta?.required_metadatas&&t?.meta?.required_metadatas.length>0&&t?.meta?.required_metadatas.some((t=>e.classList.contains(t.slug)))?e.classList.add("required"):e.classList.remove("required"))}))}}))},406:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(7143),o=s(6087);const n={};function a(e,t,s){n?.[e]?.[t]||(n?.[e]||(n[e]={}),n[e][t]={actionIntercept:null,callback:s}),(0,o.useEffect)((()=>{n[e][t].callback=s}),[e,t,s]),(0,r.use)((s=>({dispatch:r=>{const o="string"==typeof r?r:r.name,a={...s.dispatch(o)};if(o!==e)return a;if(!n[e][t].actionIntercept){const s=a[t];n[e][t].actionIntercept=(...r)=>{n[e][t].callback(s,r)}}return a[t]=n[e][t].actionIntercept,a}})))}},1987:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(7143),o=s(4764),n=s(406);function a(e,t){const s=()=>(0,r.select)(o.M_).getActiveComplementaryArea("core")===e;(0,n.A)(o.M_.name,"enableComplementaryArea",((r,o)=>{if("core"===o?.[0]&&o?.[1]===e){const e=s();t(e,(()=>r(...o)))}else r(...o)})),(0,n.A)(o.M_.name,"disableComplementaryArea",((e,r)=>{const o=s();o?t(o,(()=>e(...r))):e(...r)}))}},7527:(e,t,s)=>{function r(e,t){const s=VW_CUSTOM_STATUSES.supported_post_types.includes(e),r=VW_CUSTOM_STATUSES.status_terms.map((e=>e.slug)).includes(t);return s&&r}s.d(t,{C:()=>r})},1609:e=>{e.exports=window.React},6427:e=>{e.exports=window.wp.components},9491:e=>{e.exports=window.wp.compose},7143:e=>{e.exports=window.wp.data},4040:e=>{e.exports=window.wp.deprecated},4309:e=>{e.exports=window.wp.editPost},3656:e=>{e.exports=window.wp.editor},6087:e=>{e.exports=window.wp.element},7723:e=>{e.exports=window.wp.i18n},2279:e=>{e.exports=window.wp.plugins},1233:e=>{e.exports=window.wp.preferences},4164:(e,t,s)=>{function r(e){var t,s,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e)){var n=e.length;for(t=0;t<n;t++)e[t]&&(s=r(e[t]))&&(o&&(o+=" "),o+=s)}else for(s in e)e[s]&&(o&&(o+=" "),o+=s);return o}s.d(t,{A:()=>o});const o=function(){for(var e,t,s=0,o="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=r(e))&&(o&&(o+=" "),o+=t);return o}}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=s(1609),t=s(9491),r=s(7143),o=s(4309),n=s(3656),a=s(6087),i=s(7723),c=s(2279),l=s(4164),u=s(3393),d=s(1987);const p="vip-workflow-custom-status",m="vip-workflow-sidebar";(0,c.registerPlugin)(p,{render:(0,t.compose)((0,r.withSelect)((e=>{const{getEditedPostAttribute:t,getCurrentPostAttribute:s,isSavingPost:r,getCurrentPost:o,getCurrentPostType:a}=e(n.store),i=o(),c="auto-draft"===i?.status;return{savedStatus:s("status"),editedStatus:t("status"),metaFields:t("meta"),postType:a(),isSavingPost:r(),isUnsavedPost:c}})),(0,r.withDispatch)((e=>({onUpdateStatus(t){e(n.store).editPost({status:t},{undoIgnore:!0})}}))))((({postType:s,savedStatus:c,editedStatus:l,metaFields:A,isUnsavedPost:y,isSavingPost:T,onUpdateStatus:E})=>{const b=(0,t.useViewportMatch)("small","<"),M=(0,t.useViewportMatch)("wide",">="),C=(0,a.useMemo)((()=>{const e=g(c);return v(e,A)}),[c,A]),h=(0,a.useMemo)((()=>_(y,s,c,C)),[y,s,c,C]);(0,e.useEffect)((()=>{if(VW_CUSTOM_STATUSES.is_publish_guard_enabled){const e=document.querySelector("#editor");h?e.classList.add("disable-native-save-button"):e.classList.remove("disable-native-save-button")}}),[h]);const P=(0,a.useMemo)((()=>w(c)),[c]),U=T||C;(0,d.A)(`${p}/${m}`,((e,t)=>{U||P&&(E(P.slug),(0,r.dispatch)(n.store).savePost())}));const k=S(P,C,M),O=C?(0,i.__)("Awaiting review from a privileged user","vip-workflow"):k,x=(0,e.createElement)(f,{buttonText:k,isSavingPost:T,isDisabled:U,isTinyViewport:b});return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u.A,{postType:s,status:l,onUpdateStatus:E}),h&&(0,e.createElement)(o.PluginSidebar,{name:m,title:O,icon:x},null))}))});const f=({buttonText:t,isSavingPost:s,isDisabled:r,isTinyViewport:o})=>{const n=(0,l.A)("vip-workflow-save-button",{"is-busy":s,"is-disabled":r,"is-tiny":o});return(0,e.createElement)("div",{className:n},t)},_=(e,t,s,r)=>{if(e)return!1;const o=VW_CUSTOM_STATUSES.supported_post_types.includes(t),n=VW_CUSTOM_STATUSES.status_terms.slice(0,-1).map((e=>e.slug)).includes(s);return o&&(n||r)},S=(e,t,s)=>{let r=(0,i.__)("Save","vip-workflow");if(e){const t=e.name;if(s)
// translators: %s: Next custom status name, e.g. "Draft"
r=(0,i.sprintf)((0,i.__)("Move to %s","vip-workflow"),t);else{const e=A(t,7);
// translators: %s: Next custom status name, possibly truncated with an ellipsis. e.g. "Draft" or "Pendi…"
r=(0,i.sprintf)((0,i.__)("Move to %s","vip-workflow"),e)}}else!e&&t&&(r=(0,i.__)("Publish","vip-workflow"));return r},v=(e,t)=>{let s=!1;if(e?.meta?.required_user_ids&&e.meta.required_user_ids.length>0){const t=e.meta.required_user_ids,r=parseInt(VW_CUSTOM_STATUSES.current_user_id,10);s=!t.includes(r)}return!s&&e?.meta?.required_metadatas&&e.meta.required_metadatas.length>0&&(s=e.meta.required_metadatas.some((e=>{const s=e.meta.postmeta_key;return"checkbox"===e.meta.type?t[s]:!t[s]||0===t[s].length}))),s},g=e=>VW_CUSTOM_STATUSES.status_terms.find((t=>t.slug===e))||!1,w=e=>{const t=VW_CUSTOM_STATUSES.status_terms.findIndex((t=>t.slug===e));return-1!==t&&t!==VW_CUSTOM_STATUSES.status_terms.length-1&&VW_CUSTOM_STATUSES.status_terms[t+1]},A=(e,t)=>e.length>t?e.slice(0,t)+"…":e})()})();
//# sourceMappingURL=custom-status-block.js.map