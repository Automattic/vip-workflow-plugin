(()=>{"use strict";var e={6772:(e,t,r)=>{r.d(t,{A:()=>i});var o=r(5573),n=r(4848);const i=(0,n.jsx)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(o.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.625 5.5h9.75c.069 0 .125.056.125.125v9.75a.125.125 0 0 1-.125.125h-9.75a.125.125 0 0 1-.125-.125v-9.75c0-.069.056-.125.125-.125ZM4 5.625C4 4.728 4.728 4 5.625 4h9.75C16.273 4 17 4.728 17 5.625v9.75c0 .898-.727 1.625-1.625 1.625h-9.75A1.625 1.625 0 0 1 4 15.375v-9.75Zm14.5 11.656v-9H20v9C20 18.8 18.77 20 17.251 20H6.25v-1.5h11.001c.69 0 1.249-.528 1.249-1.219Z"})})},544:(e,t,r)=>{r.d(t,{A:()=>s});var o=r(1609),n=r(6427),i=r(9491),l=r(6087);function s(e){const{asyncFunction:t,onCopied:r,children:s,...a}=e,[c,p]=(0,l.useState)(null),u=(0,l.useRef)(null),w=(0,i.useCopyToClipboard)(c,(()=>{r(c)}));return(0,l.useLayoutEffect)((()=>{c&&u.current?.click()}),[c]),(0,o.createElement)(o.Fragment,null,(0,o.createElement)(n.Button,{...a,onClick:async()=>{const e=await t();p(e)}},s),(0,o.createElement)(n.Button,{style:{display:"none"},ref:(0,i.useMergeRefs)([u,w])}))}},1020:(e,t,r)=>{var o=r(1609),n=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),l=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,r){var o,a={},c=null,p=null;for(o in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(p=t.ref),t)i.call(t,o)&&!s.hasOwnProperty(o)&&(a[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===a[o]&&(a[o]=t[o]);return{$$typeof:n,type:e,key:c,ref:p,props:a,_owner:l.current}}},4848:(e,t,r)=>{e.exports=r(1020)},1609:e=>{e.exports=window.React},1455:e=>{e.exports=window.wp.apiFetch},4715:e=>{e.exports=window.wp.blockEditor},6427:e=>{e.exports=window.wp.components},9491:e=>{e.exports=window.wp.compose},7143:e=>{e.exports=window.wp.data},3656:e=>{e.exports=window.wp.editor},6087:e=>{e.exports=window.wp.element},7723:e=>{e.exports=window.wp.i18n},692:e=>{e.exports=window.wp.notices},2279:e=>{e.exports=window.wp.plugins},5573:e=>{e.exports=window.wp.primitives}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=r(1609),t=r(1455),o=r.n(t),n=r(4715),i=r(6427),l=r(9491),s=r(7143),a=r(3656),c=r(6087),p=r(7723),u=r(6772),w=r(692),d=r(2279),v=r(544);const m=({onUrl:t,onCloseModal:r})=>{const[n,l]=(0,c.useState)(!1),[a,u]=(0,c.useState)(!1),d=VW_SECURE_PREVIEW.expiration_options,m=d.find((e=>!0===e.default))?.value||d?.[0]?.value,[_,f]=(0,c.useState)(m),E=d.map((({label:e,value:t})=>({label:e,value:t})));return(0,e.createElement)(i.Modal,{title:"Generate secure preview",size:"medium",onRequestClose:r},(0,e.createElement)(i.SelectControl,{label:(0,p.__)("Link expiration","vip-workflow"),value:_,onChange:f,options:E}),(0,e.createElement)(i.CheckboxControl,{className:"vip-workflow-one-time-use-checkbox",label:(0,p.__)("One-time use","vip-workflow"),help:(0,p.__)("The link will expire after one visit.","vip-workflow"),checked:a,onChange:()=>u((e=>!e))}),(0,e.createElement)(i.Flex,{justify:"flex-end"},n&&(0,e.createElement)(i.Spinner,null),(0,e.createElement)(v.A,{variant:"primary",asyncFunction:async()=>{let e={};try{l(!0),e=await o()({url:VW_SECURE_PREVIEW.url_generate_preview,method:"POST",data:{expiration:_,is_one_time_use:a}})}catch(e){const t=VW_SECURE_PREVIEW.text_preview_error+" "+e.message;(0,s.dispatch)(w.store).createErrorNotice(t,{id:"vw-secure-preview",isDismissible:!0})}finally{l(!1)}if(e?.url)return e.url},onCopied:e=>{(0,s.dispatch)(w.store).createNotice("info",(0,p.__)("Link copied to clipboard."),{isDismissible:!0,type:"snackbar"}),r(),t(e)}},(0,p.__)("Copy Link","vip-workflow"))))},_=({url:t})=>{const r=(0,c.useRef)(null),o=(0,l.useCopyToClipboard)(t,(()=>{(0,s.dispatch)(w.store).createNotice("info",(0,p.__)("Link copied to clipboard."),{isDismissible:!0,type:"snackbar"})})),a={anchorRef:r,placement:"left-start",offset:36,shift:!0},d="/"+t.split("/").pop();return(0,e.createElement)("div",{className:"vip-workflow-secure-preview-dropdown",ref:r},(0,e.createElement)(i.Dropdown,{popoverProps:a,focusOnMount:!0,renderToggle:({onToggle:t})=>(0,e.createElement)(i.Button,{size:"compact",variant:"tertiary",onClick:t},(0,e.createElement)(i.__experimentalTruncate,{limit:15,ellipsizeMode:"tail"},d)),renderContent:({onClose:r})=>(0,e.createElement)("div",{className:"vip-workflow-secure-link-dropdown-content"},(0,e.createElement)(n.__experimentalInspectorPopoverHeader,{title:(0,p.__)("Secure Preview Link"),onClose:r}),(0,e.createElement)(i.ExternalLink,{className:"editor-post-url__link",href:t,target:"_blank"},t))}),(0,e.createElement)(i.Button,{icon:u.A,label:(0,p.sprintf)(
// Translators: %s is a placeholder for the link URL, e.g. "Copy link: https://my-site.com/?p=123".
// Translators: %s is a placeholder for the link URL, e.g. "Copy link: https://my-site.com/?p=123".
(0,p.__)("Copy link: %s"),t),ref:o,size:"compact"}))},f=(0,l.compose)((0,s.withSelect)((e=>{const{getEditedPostAttribute:t,getCurrentPostType:r,getCurrentPost:o}=e(a.store),n=o(),i="auto-draft"===n?.status;return{status:t("status"),postType:r(),isDraft:i}})))((({status:t,postType:r,isDraft:o})=>{const[n,l]=(0,c.useState)(!1),[s,u]=(0,c.useState)(null),w=(0,c.useMemo)((()=>VW_SECURE_PREVIEW.custom_status_slugs.includes(t)&&VW_SECURE_PREVIEW.custom_post_types.includes(r)&&!o),[t,r,o]);return(0,e.createElement)(e.Fragment,null,w&&(0,e.createElement)(a.PluginPostStatusInfo,{className:"vip-workflow-secure-preview"},(0,e.createElement)("div",{className:"vip-workflow-secure-preview-row"},(0,e.createElement)("div",{className:"vip-workflow-secure-preview-label"},(0,p.__)("Secure Preview","vip-workflow")),!s&&(0,e.createElement)(i.Button,{className:"vip-workflow-secure-preview-button",variant:"tertiary",onClick:()=>{l(!0)}},(0,p.__)("Generate Link","vip-workflow")),n&&(0,e.createElement)(m,{onUrl:u,onCloseModal:()=>l(!1)}),s&&(0,e.createElement)(_,{url:s}))))}));(0,d.registerPlugin)("vip-workflow-secure-preview",{icon:"vip-workflow",render:f})})()})();
//# sourceMappingURL=secure-preview.js.map